# 题库管理工具使用说明

## 环境要求

在使用本工具前，需要安装以下依赖：

1. **Node.js** (>= 14.0.0)
2. **FFmpeg** - 用于音频处理

### 安装 FFmpeg

**Windows:**
1. 下载 FFmpeg: https://ffmpeg.org/download.html
2. 解压到任意目录（如：`C:\ffmpeg`）
3. 将 `C:\ffmpeg\bin` 添加到系统环境变量 PATH
4. 验证安装：打开命令行输入 `ffmpeg -version`

**macOS:**
```bash
brew install ffmpeg
```

**Linux:**
```bash
sudo apt-get install ffmpeg  # Ubuntu/Debian
sudo yum install ffmpeg      # CentOS/RHEL
```

## 快速开始

在项目根目录下执行以下命令：

1. **安装依赖**
   ```bash
   pnpm install
   ```

2. **运行工具**
   ```bash
   pnpm manager
   ```

## 功能说明

### 1. 查看所有歌手
显示题库中所有歌手的列表，包括歌手ID、名称和歌曲数量。

### 2. 添加新歌手
添加一个新的歌手到题库中。

**操作步骤：**
1. 选择菜单选项 `2`
2. 输入歌手名称
3. 系统会自动生成歌手ID（如：002, 003...）
4. 自动创建歌手目录 `Question/[ID]/`

**示例：**
```
请输入歌手名称: 周杰伦
✅ 成功添加歌手: [002] 周杰伦
📁 歌手目录: Question/002/
💡 提示: 请将该歌手的 mp3 文件放入 Question/002/ 目录中
```

### 3. 批量导入歌曲（推荐）
**这是最便捷的方式！** 直接从文件名提取歌名，自动重命名并录入。

**操作步骤：**
1. 将以**原始格式命名**的 mp3 文件放入歌手目录
   - 例如：`周杰伦 - 晴天.mp3`, `周杰伦 - 七里香 (Live).mp3`, `周杰伦 - 稻香 (Live).mp3`等各类格式
2. 选择菜单选项 `3`
3. 输入歌手ID（如：002）
4. 工具会自动：
   - 扫描目录中的 mp3 文件
   - 显示待处理的文件列表
   - 从文件名提取歌名
5. 确认后自动批量处理：
   - 重命名文件为 `001.mp3`, `002.mp3`...
   - 将歌名录入到题库当中

**亮点：**
- 无需手动输入歌名
- 自动重命名文件
- 自动截取音频前6秒
- 智能去重（检查已有歌曲和新增歌曲）
- 批量处理，效率高
- 支持中文文件名

### 4. 手动添加歌曲
适用于已经按数字ID命名的 mp3 文件，需要手动输入歌名。

**操作步骤：**
1. 将 mp3 文件放入对应歌手目录
2. mp3 文件命名格式：`001.mp3`, `002.mp3`, `003.mp3`...
3. 选择菜单选项 `4`
4. 输入歌手ID
5. 工具会扫描目录中的数字ID命名的 mp3 文件
6. 为每个未录入的歌曲手动输入歌名
7. 输入 `q` 退出录入

**示例：**
```
📁 目录中的 mp3 文件:
  001.mp3 ✅ (已录入: Stay Here)
  002.mp3 ✅ (已录入: 一半)
  003.mp3 ⚠️  (未录入)
  004.mp3 ⚠️  (未录入)

请为未录入的歌曲输入歌名 (输入 q 退出):
  [003.mp3] 歌名: 晴天
    ✅ 已添加
  [004.mp3] 歌名: 七里香
    ✅ 已添加

✅ 成功添加 2 首歌曲
```

### 5. 删除歌曲
删除歌手的某首歌曲记录。

**注意：** 此操作只删除数据库记录，不会删除 mp3 文件，需要手动删除。

**操作步骤：**
1. 选择菜单选项 `5`
2. 输入歌手ID
3. 输入要删除的歌曲ID
4. 确认删除

### 6. 查看歌手详情
查看指定歌手的所有歌曲列表。

**操作步骤：**
1. 选择菜单选项 `6`
2. 输入歌手ID
3. 显示该歌手的所有歌曲

### 7. 设置歌手头像
为歌手设置头像。

**操作步骤：**
1. 选择菜单选项 `7`
2. 输入歌手ID
3. 将头像图片文件放入对应歌手目录中
4. 输入头像文件名（如：avatar.jpg）

## 文件结构

```
Question/
├── index.json              # 题库索引文件
├── 001/                    # 歌手目录（ID命名）
│   ├── info.json          # 歌手信息文件
│   ├── 001.mp3            # 歌曲文件（ID命名）
│   ├── 002.mp3
│   └── ...
├── 002/
│   ├── info.json
│   ├── 001.mp3
│   └── ...
└── ...
```

### index.json 格式
```json
{
  "version": "2.0",
  "lastUpdate": "2025-11-30T10:52:44.106Z",
  "avatar": "avatar.jpg",
  "artists": [
    {
      "id": "001",
      "name": "薛之谦",
      "songCount": 72
    }
  ]
}
```

### info.json 格式
```json
{
  "artistId": "001",
  "artistName": "薛之谦",
  "avatar": "avatar.jpg",
  "songCount": 72,
  "songs": [
    {
      "id": "001",
      "name": "Stay Here", 
      "artists": ["薛之谦"]
    },
    {
      "id": "002",
      "name": "一半",
      "artists": ["薛之谦"]
    }
  ]
}
```

## 添加新歌手完整流程（推荐方式）

1. **运行工具**
   ```bash
   npm run manager
   ```

2. **添加歌手**
   - 选择 `2` - 添加新歌手
   - 输入歌手名称，如：`周杰伦`
   - 记住生成的歌手ID，如：`002`

3. **准备音频文件**
   - 将该歌手的 mp3 文件放入 `Question/002/` 目录
   - **文件命名：直接用歌名命名**
   - 例如：`晴天.mp3`, `七里香.mp3`, `稻香.mp3`

4. **批量导入歌曲**
   - 选择 `3` - 批量导入歌曲
   - 输入歌手ID：`002`
   - 查看待处理文件列表
   - 输入 `y` 确认导入
   - 工具会自动重命名文件并录入歌名

5. **验证**
   - 选择 `6` - 查看歌手详情
   - 输入歌手ID：`002`
   - 检查歌曲列表是否正确

## 注意事项

1. **文件命名规范**
   - 歌手目录：使用3位数字ID（001, 002, 003...）
   - **批量导入模式**：mp3 文件直接用原始格式
     - 例如：`周杰伦 - 晴天.mp3`, `周杰伦 - 七里香 (Live).mp3`, `周杰伦 - 稻香.mp3`
     - 工具会自动重命名为：`001.mp3`, `002.mp3`, `003.mp3`
   - **手动添加模式**：mp3 文件需要预先用数字ID命名（001.mp3, 002.mp3...）

2. **音频文件要求**
   - 格式：mp3
   - 建议码率：128kbps 或更高
   - 时长：任意（工具会自动截取前6秒）
   - **注意**：批量导入时会自动截取音频前6秒，原文件会被替换

3. **数据安全**
   - 工具会自动更新 `index.json` 和 `info.json`
   - 建议定期备份 `Question` 目录
   - 删除歌曲时，mp3 文件不会被删除，需手动处理

4. **ID分配**
   - 歌手ID按添加顺序自动递增
   - 歌曲ID需要手动命名 mp3 文件
   - 建议从 001 开始连续编号

## 常见问题

**Q: 如何修改歌曲名称？**
A: 先删除该歌曲记录，然后重新添加。

**Q: 可以跳过某些 mp3 文件不录入吗？**
A: 可以，在输入歌名时直接按回车跳过，或输入 `q` 退出。

**Q: 如何删除歌手？**
A: 目前需要手动删除：
1. 删除 `Question/[ID]/` 目录
2. 编辑 `index.json`，移除对应的歌手记录

**Q: mp3 文件可以不连续编号吗？**
A: 可以，但建议连续编号便于管理。

## 技术支持

如有问题，请检查：
1. Node.js 版本是否 >= 14
2. `Question` 目录是否存在
3. 文件权限是否正确
